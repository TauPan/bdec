#!/usr/bin/env python

import sys
import dcdr.data as dt
import dcdr.spec.xmlspec as xmlspec
import dcdr.output.xmlout as xmlout

spec = sys.argv[1]
protocol = xmlspec.Importer().load(file(spec, 'r'))

if len(sys.argv) == 3:
    xml = file(sys.argv[2], 'rb').read()
else:
    xml = sys.stdin.read()

data = xmlout.encode(protocol, xml)
binary = str(reduce(lambda a,b:a+b, data))
sys.stdout.write(binary)
